private static readonly Instruction[] _requiredInstructionSequenceForWrite =
{
    new MOVWF(9, 1), // EECON2
    new MOVLW(0xAA),
    new MOVWF(9, 1), // EECON2
    new BSF(8, 1), // Set WR bit --> begin write
};


public void CheckInstruction(Instruction? instruction)
{
    if (instruction == null)
    {
        _nextRequiredInstructionForWrite = 0;
    }
    else
    {
        if (_nextRequiredInstructionForWrite == _requiredInstructionSequenceForWrite.Length)
        {
            _nextRequiredInstructionForWrite = 0;
        }

        Instruction expected = _requiredInstructionSequenceForWrite[_nextRequiredInstructionForWrite];
        if (instruction.Equals(expected))
        {
            _nextRequiredInstructionForWrite++;
        }
        else
        {
            _nextRequiredInstructionForWrite = 0;
        }
    }
}

